// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·æ¨¡å‹ (é¡¾å®¢æˆ–ç®¡ç†å‘˜)
model User {
  id           String        @id @default(cuid())
  email        String        @unique
  name         String?
  password     String
  role         Role          @default(USER)
  appointments Appointment[]
  // ğŸ‘‡ --- æ–°å¢å­—æ®µ --- ğŸ‘‡
  passwordResetToken   String?   @unique // å¯†ç é‡ç½®Token
  passwordResetExpires DateTime? // Token è¿‡æœŸæ—¶é—´
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

// å‘˜å·¥æ¨¡å‹
model Employee {
  id           String        @id @default(cuid())
  name         String
  title        String // e.g., "é«˜çº§ç¾ç”²å¸ˆ"
  // å…³ç³»ï¼šä¸€ä¸ªå‘˜å·¥å¯ä»¥å¤„ç†å¤šä¸ªé¢„çº¦
  appointments Appointment[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
}

// 1. æ–°å¢ Image æ¨¡å‹
model Image {
  id         String    @id @default(cuid())
  url        String // Cloudinary è¿”å›çš„å›¾ç‰‡URL
  altText    String? // å›¾ç‰‡çš„æ›¿ä»£æ–‡æœ¬ï¼Œç”¨äºSEOå’Œå¯è®¿é—®æ€§
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  // å…³ç³»ï¼šImage æŒ‡å‘å®ƒçš„â€œå…³ç³»è¡¨â€ï¼Œä»¥ä¾¿è¿›è¡Œåå‘æŸ¥è¯¢
  serviceImages ServiceImage[]
}

// æœåŠ¡é¡¹ç›®æ¨¡å‹
model Service {
  id           String        @id @default(cuid())
  name         String
  description  String?
  price        Float
  duration     Int // æŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
  // å…³ç³»ï¼šä¸€ä¸ªæœåŠ¡å¯ä»¥è¢«å¤šæ¬¡é¢„çº¦
  appointments Appointment[]
  // å…³ç³»ï¼šService ä¹ŸæŒ‡å‘å®ƒçš„â€œå…³ç³»è¡¨â€
  serviceImages ServiceImage[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
}

// è¿™æ˜¯æ–°å¢çš„â€œå…³è”è¡¨â€ï¼Œæ˜¯ Service å’Œ Image ä¹‹é—´çš„æ¡¥æ¢
model ServiceImage {
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId String
  image     Image   @relation(fields: [imageId], references: [id], onDelete: Cascade)
  imageId   String

  assignedAt DateTime @default(now())

  // è®¾ç½®è”åˆä¸»é”®
  @@id([serviceId, imageId])
}

// é¢„çº¦æ¨¡å‹ (æ ¸å¿ƒ)
model Appointment {
  id         String   @id @default(cuid())
  // å…³ç³»ï¼šå…³è”åˆ°å“ªä¸ªç”¨æˆ·
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  // å…³ç³»ï¼šå…³è”åˆ°å“ªä¸ªå‘˜å·¥
  employee   Employee @relation(fields: [employeeId], references: [id])
  employeeId String
  // å…³ç³»ï¼šå…³è”åˆ°å“ªä¸ªæœåŠ¡
  service    Service  @relation(fields: [serviceId], references: [id])
  serviceId  String

  appointmentTime DateTime // é¢„çº¦çš„å…·ä½“æ—¶é—´
  status          AppointmentStatus @default(PENDING) // é¢„çº¦çŠ¶æ€
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  reminderSent Boolean @default(false)
}

// æšä¸¾ï¼šç”¨æˆ·è§’è‰²
enum Role {
  USER  // æ™®é€šç”¨æˆ·
  ADMIN // ç®¡ç†å‘˜
}

// æšä¸¾ï¼šé¢„çº¦çŠ¶æ€
enum AppointmentStatus {
  PENDING   // å¾…ç¡®è®¤
  CONFIRMED // å·²ç¡®è®¤
  COMPLETED // å·²å®Œæˆ
  CANCELLED // å·²å–æ¶ˆ
}